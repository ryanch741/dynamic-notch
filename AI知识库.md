# 刘海屏效率应用 AI 知识库

> 本文档用于为 AI 助手提供本项目的长期上下文与决策依据，方便在 VibeCoding 模式下持续协作、自动补全和生成代码。人类和 AI 都应在重大变更后更新此文档。

## 1. 项目关键信息

- **项目名称**：
  - 中文：灵动刘海
  - 英文：Notch Island
- **项目目标**：
  - 将 Mac 刘海区域打造成信息中心，类似 NookX/NotchNook。
  - 提供时间、天气、音乐、番茄钟、待办、AI 对话等功能。
- **目标平台与环境**：
  - 平台：macOS 刘海屏设备（如 2021+ MacBook Pro）。
  - 最低系统：建议 macOS 13+。
  - 首要优化目标：刘海区域适配和体验。
- **技术栈约束**：
  - 语言：Swift。
  - UI：SwiftUI + AppKit（状态栏、窗口管理等）。
  - 依赖管理：Swift Package Manager。
  - 首个版本不使用 Electron/Tauri 等 Web 容器。

## 2. 功能知识

### 2.1 模块列表与简介

- **刘海信息条（NotchBar）**
  - 常驻顶部，贴合刘海区域的细长信息条。
  - 显示主要状态信息：时间、天气、音乐、番茄状态等摘要。

- **状态栏模块（StatusBar）**
  - 菜单栏图标和菜单。
  - 入口：打开设置、退出应用、快速切换模式等。

- **时间/日期模块（Time）**
  - 获取当前系统时间、日期、星期。
  - 周期性刷新（例如每秒或每分钟，根据 UI 需求）。

- **天气模块（Weather）**
  - 通过天气 API 获取当前天气图标和温度。
  - 城市可配置；可使用 IP 定位或手动输入。

- **待办模块（Todo）**
  - 支持添加、勾选、删除简短待办事项。
  - 数据持久化：本地（UserDefaults 或轻量数据库）。

- **快捷方式模块（Shortcuts / Launcher）**
  - 通过设置界面添加和管理快捷方式。
  - 支持多种类型：
    - 应用：快速启动本机应用（可按名称或路径配置）。
    - 网址：快速打开指定网站，尝试自动获取网站图标（favicon），若获取失败则使用默认图标。
  - 快捷方式可在刘海信息条中以图标形式展示，或在展开面板中以列表形式展示。

- **音乐模块（Music）**
  - 读取当前播放音乐的信息（歌名、歌手，尽量兼容 Apple Music）。
  - 可选功能：显示简单歌词、播放进度条。

- **番茄钟模块（Pomodoro）**
  - 定义专注时长、休息时长（默认 25/5 分钟）。
  - 状态：未开始 / 专注中 / 休息中。
  - 完成或状态切换时可发送系统通知。

- **AI 小助手模块（AI Assistant / Chat）**
  - 提供小对话窗口，支持调用 LLM API。
  - 用途：快速问答、总结剪贴板内容、翻译等。

### 2.2 版本划分

- **v1 核心版**：时间/天气/Todo + 刘海信息条 + 状态栏和设置。
- **v2 增强版**：音乐信息、番茄钟、快捷方式模块（应用/网址等）、更多小组件和个性化主题。
- **v3 进阶版**：AI 小助手、智能提醒与自动化。

> AI 在回答与规划相关问题时，应优先参考本节内容来判断当前版本范围，避免越界设计过多超前功能。

## 3. 设计与约束知识

### 3.1 UI/UX 原则

- 优先保证**轻量、不打扰**：
  - 刘海信息条不遮挡系统元素，不影响窗口拖拽。
  - 动画柔和，不频繁闪烁。
- 风格尽量**原生化**：
  - 使用系统提供的颜色、模糊和控件风格。
  - 少量圆角和阴影即可。
- **刘海动态交互（灵动岛式效果）**：
  - 鼠标移入物理刘海区域触发展开动画，从刘海中线向两侧和下方扩展面板。
  - 面板内容只绘制在可显示区域，严格不覆盖物理刘海黑块。
  - 收起时面板缩回到刘海，视觉效果像"放大的刘海缩小回去"，带有弹性跳动感。
  - 该效果在 v2 阶段实现，作为交互与动画优化的核心特性。

### 3.2 技术约束

- 运行环境：macOS 原生，不依赖浏览器容器。
- 网络调用：
  - 天气与 AI API 调用通过标准 HTTPS。
  - 密钥不写入仓库，可用占位符和本地配置。
- 持久化：
  - 使用系统轻量机制（UserDefaults、文件存储），减少外部依赖。

### 3.3 对 AI 的特殊要求

- 修改代码时：
  - 遵守《开发规范.md》中约定的架构和命名规则。
  - 不轻易改动已有模块边界，优先在模块内部扩展。
- 提出修改方案时：
  - 优先考虑最小变更，不为引入炫技而增加复杂度。

## 4. 常见问答（给 AI 的快捷知识）

### Q1：为什么不用 Electron/Tauri？

- **A**：
  - 首要目标是深度适配 macOS 刘海和状态栏，原生体验更好。
  - 资源占用和交互延迟对常驻工具尤为敏感，原生更可控。
  - 将来若需要跨平台，再新增一套前端架构，而不是在首版就牺牲体验。

### Q2：最低需要实现哪些功能才算 v1 完成？

- **A**：
  1. 常驻刘海信息条（简洁显示时间/日期）。
  2. 状态栏图标 + 基础菜单（至少有“打开设置”和“退出”）。
  3. 基础 Todo（添加/勾选/删除 + 本地持久化）。
  4. 简单天气信息（若暂时没有 API，可以先使用 Mock 数据，但需要预留接口）。

### Q3：遇到“功能边界不清”的时候应该怎么做？

- **A**：
  - 优先遵循以下思路：
    1. 当前迭代版本（v1/v2/v3）范围是什么？
    2. 该功能是否可以通过配置或小模块扩展，而不是大改架构？
    3. 如果影响较大，先在本知识库中补充一条“设计决策”，再建议由人类确认。

### Q4：如何处理第三方 API 密钥？

- **A**：
  - 在代码中使用占位符，例如 `YOUR_API_KEY_HERE`。
  - 在文档中提示开发者使用本地配置文件/环境变量提供真实密钥。
  - 不将真实密钥写入仓库，也不要在示例中暴露真实密钥。

## 5. 设计决策记录（持续更新）

> 本节用于记录已经达成共识的关键决策，便于 AI 和人类后续统一遵循。

1. **技术栈**：首版采用 Swift + SwiftUI + AppKit，原生 macOS 应用，不使用 Electron/Tauri。
2. **目标设备**：优先适配有刘海的 MacBook；其他 Mac 设备可显示信息条但可能不完全占用刘海区域。
3. **性能目标**：
   - 应用常驻后台，CPU 与内存占用尽量保持低水平。
   - 定时任务（如时间更新、番茄计时）使用合适的计时机制，避免频繁轮询。
4. **可配置性**：
   - 用户可以通过设置打开/关闭功能模块（时间/天气/音乐/番茄/Todo/AI）。
   - 未来考虑导出/导入配置方案。

## 6. 维护约定

- 每当引入以下变更之一时，应更新本 AI 知识库：
  - 新增模块或删除模块。
  - 修改核心技术栈（例如新增跨平台方案）。
  - 调整版本规划（v1/v2/v3 范围变化）。
  - 关键设计决策发生改变（例如改用新的刘海布局方案）。
- 更新方式：
  - 用简洁语句追加到对应章节（模块列表 / 决策记录 / 常见问答）。
  - 保持段落结构清晰，方便 AI 解析和检索。

---

> 若 AI 在回答问题时发现现有知识与代码实现明显不一致，应主动提示人类开发者，并建议同步更新本知识库，以避免后续混乱。
