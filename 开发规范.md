# 刘海屏效率应用 开发规范

> 本文档用于约束和指导本项目的整体设计与开发方式，确保后续迭代保持一致性，便于人类与 AI 协作（VibeCoding）。

## 1. 项目概述

- **项目名称（暂定）**：Notch Productivity / 刘海效率岛
- **目标平台**：macOS，有刘海的 MacBook（例如 14/16 寸 MacBook Pro 2021+）
- **核心定位**：将 Mac 刘海区域打造成信息中心（类似 NookX/NotchNook），提供时间、天气、音乐、番茄钟、待办、AI 辅助等能力。

## 2. 功能规划

### 2.1 v1 核心版

- **刘海信息条**：
  - 常驻刘海区域附近，显示时间、日期等基础信息。
  - 悬停或点击时可稍微放大或展示更多内容。
- **基础状态信息**：
  - 时间、日期、星期。
  - 简单天气信息（图标 + 温度）。
- **轻量待办（Todo）**：
  - 通过弹出小窗口快速添加/勾选/删除任务。
  - 数据本地持久化即可（例如 UserDefaults）。
- **菜单栏图标与设置**：
  - 菜单栏常驻图标，点击打开设置或主弹窗。
  - 设置项包括：开机自启、主题模式（浅色/深色/跟随系统）、模块显示开关。

### 2.2 v2 增强版

- **音乐信息与歌词**：
  - 读取当前播放音乐（优先适配 Apple Music，后续可扩展 Spotify）。
  - 刘海区域显示：歌名 - 歌手，展开显示进度条和一行歌词。
- **番茄钟**：
  - 支持启动/暂停/重置番茄计时（默认 25 分钟，可配置）。
  - 刘海区域显示番茄状态及剩余时间，可发送系统通知提醒。
- **更多小组件**：
  - 简单日程提示（今日剩余事件数量、最近一条内容）。
  - 快捷方式模块：通过设置界面添加/管理快捷方式，以图标形式展示在刘海信息条或展开面板中；支持应用、网址等多种类型。
  - 快捷启动入口（指定 App 或 URL），网址支持自动读取网站图标（如无法获取则使用默认图标）。
- **个性化配置**：
  - 信息条样式主题（极简/信息密集/圆角气泡等）。
  - 模块显示顺序与可见性配置。

### 2.3 v3 进阶 / AI 版

- **AI 小助手**：
  - 刘海区域提供 AI 按钮，弹出对话窗口。
  - 支持调用指定 LLM API（例如 OpenAI、自建模型等）。
- **智能提醒与自动化（可选）**：
  - 根据日历事件、时间段等自动展示提醒。
  - 自动切换「专注模式」「轻量模式」。

## 3. 技术栈与架构

### 3.1 技术选型

- **语言**：Swift
- **UI 框架**：SwiftUI 为主，必要时结合 AppKit（NSStatusBar、窗口管理等）。
- **项目类型**：原生 macOS App（AppKit/SwiftUI 混合）。
- **依赖管理**：Swift Package Manager（SPM）。
- **运行环境要求**：
  - macOS 13+（可根据实际需求调整最低版本）。
  - Apple Silicon 优先适配，兼容 Intel 如有必要。

> 约束：首个可用版本不采用 Electron/Tauri 等 Web 容器；如需多平台扩展，另行设计。

### 3.2 基本架构

- **应用层次结构**（建议）：
  - `App` 入口：应用生命周期管理，启动主控制器。
  - **状态栏模块**：
    - 使用 `NSStatusBar` 创建菜单栏图标和弹出窗口。
  - **刘海信息条模块**：
    - 控制窗口位置与大小，贴合刘海区域。
    - 统一布局不同信息组件（Widget）。
  - **业务模块**：
    - 时间/日期模块
    - 天气模块
    - Todo 模块
    - 快捷方式模块
    - 音乐模块
    - 番茄钟模块
    - AI 模块（v3）
  - **基础服务**：
    - 配置管理（UserDefaults + 可能的配置文件）。
    - 网络请求（天气 / AI / 其他 API）。
    - 持久化（Todo、设置、部分状态）。

## 4. UI 与交互规范

### 4.1 刘海区域布局

- **原则**：
  - 不遮挡刘海内的系统元素（摄像头等），根据屏幕安全区域布局。
  - 高度控制在不影响标题栏操作的范围内，尽量轻量、不干扰。
- **位置**：
  - 默认居中于刘海上方/附近，水平居中。
  - 可考虑提供少量偏移配置，但不在 v1 强制实现。

### 4.2 交互行为

- **刘海区域动态交互（类似 iPhone 灵动岛效果）**：
  - **触发条件**：鼠标移入物理刘海黑色区域（摄像头/传感器所在位置）。
  - **展开动画**：
    - 从刘海中线位置开始，向两侧和下方扩展，形成一个较大的"刘海面板"。
    - 动画应有弹性跳动感，避免生硬线性缩放。
    - 扩展后的面板可展示更多信息（如详细天气、待办列表、快捷方式等）。
  - **内容绘制约束**：
    - **严格禁止在物理刘海黑块区域绘制任何内容**（该区域不可显示像素）。
    - 面板内容只能在刘海周围的可显示区域绘制（上下左右留白区域）。
    - 视觉上营造"从刘海中长出"的效果，但实际像素不得覆盖刘海。
  - **收起动画**：
    - 鼠标移出或交互结束时，面板缩回到刘海中线位置。
    - 视觉效果像是"放大的刘海缩小回去"，同样带有弹性感。
    - 最终回到初始的细条状态或完全隐藏。

- **悬停（非展开状态）**：
  - 鼠标移动到刘海信息条区域时，允许轻微放大、亮度增强，以提示可交互。
  - 这是一个轻量级提示，与上面的"完全展开"是两种不同的交互层次。

- **点击**：
  - 左键点击：展开详细内容或打开对应模块弹窗。
  - 右键点击：显示快速菜单（如模块开关、设置入口）。

- **动画**：
  - 避免过于复杂和频繁的动画；以淡入淡出、轻微缩放为主。
  - 刘海动态展开/收起动画应流畅且带弹性，参考 iPhone 灵动岛的动效风格。

### 4.3 视觉风格

- **主题**：
  - 支持浅色 / 深色 / 跟随系统。
  - 颜色选择尽量贴合 macOS 原生风格（使用系统色彩）。
- **组件风格**：
  - 圆角矩形为主，少量阴影即可，不做夸张特效。

## 5. 开发规范

### 5.1 代码风格

- 遵循 Swift 官方推荐风格：
  - 类型和协议名称使用 UpperCamelCase，例如 `MainViewModel`。
  - 变量、函数名使用 lowerCamelCase，例如 `loadWeatherData()`。
  - 使用明确的类型推断，减少过度简写变量名。
- 模块命名以功能为主，避免大杂烩。

### 5.2 目录结构（建议）

- `App/`：应用入口、AppDelegate、SceneDelegate 等。
- `Modules/`：
  - `NotchBar/`：刘海信息条视图及布局相关。
  - `StatusBar/`：菜单栏图标与弹出窗口。
  - `Time/`、`Weather/`、`Todo/`、`Music/`、`Pomodoro/`、`AI/` 等业务模块。
- `Services/`：网络、配置、存储等。
- `Shared/`：通用组件、工具函数、扩展。

> 目录结构可根据 Xcode 工程实际情况微调，但应保持清晰，AI 修改代码时需遵循同样结构。

### 5.3 配置与密钥

- 不在代码库中硬编码第三方 API 密钥（如天气服务、AI 服务）。
- 开发环境使用本地配置文件或环境变量，必要时使用占位符示例配置。

### 5.4 测试与调试

- 优先保证核心逻辑（计时器、Todo 持久化、API 调用）可单独测试。
- 若添加单元测试：
  - 测试文件与模块对应（如 `WeatherServiceTests`）。
  - 不在测试中依赖真实外部服务，可使用 Mock。

## 6. 版本与发布策略

- **版本号规则**：遵循 `MAJOR.MINOR.PATCH`。
- **分支管理（若使用 Git）**：
  - `main`：稳定可用版本。
  - `feature/*`：新功能开发分支。
- **发布方式**：
  - 初期通过开发者签名 + 本地安装测试。
  - 若有需要，再规划 Mac App Store 上架流程。

## 7. VibeCoding 协作约定

- 人类开发者与 AI 协作开发时，应：
  - 在提交前由人类开发者本地运行和验证关键功能。
  - AI 在修改代码时遵守本规范中的架构和命名规则。
  - 所有新模块在文档（本规范或 AI 知识库）中更新简要说明。

## 8. 开发计划与进度追踪

> 本节作为“计划文档”，用于跟踪各阶段任务的完成情况，建议通过 Markdown 复选框（`[ ]`/`[x]`）标记进度。

### 8.1 总体阶段划分

- [ ] **阶段 1：需求与规范整理**
  - 明确项目目标、功能范围（v1/v2/v3）。
  - 完成《开发规范.md》和《AI知识库.md》初稿，并经人工确认。

- [ ] **阶段 2：工程骨架与基础结构**
  - 在本仓库中创建 SwiftUI macOS 工程（原生 App）。
  - 按约定建立基础目录结构：`App/`、`Modules/`、`Services/`、`Shared/`。

- [ ] **阶段 3：v1 基础能力**
  - 实现刘海信息条 NotchBar（基础布局和显示）。
  - 实现菜单栏 StatusBar（图标 + 基础菜单）。
  - 实现设置入口（打开偏好设置窗口）。

- [ ] **阶段 4：v1 核心功能模块**
  - 时间/日期模块：实时显示当前时间、日期、星期。
  - 天气模块：对接天气 API 或先使用 Mock 数据，展示图标和温度。
  - Todo 模块：支持添加/勾选/删除，使用本地持久化存储（如 UserDefaults）。

- [ ] **阶段 5：v2 结构预埋**
  - 设计快捷方式模块（应用/网址）的数据模型与接口。
  - 预留番茄钟模块、音乐模块需要的服务与接口（不必一次实现全部逻辑）。

- [ ] **阶段 6：v2 功能完善**
  - 完整实现快捷方式模块：
    - 通过设置添加/管理快捷方式。
    - 支持应用、网址类型；网址尝试自动获取网站图标（失败则使用默认图标）。
    - 在刘海信息条或展开面板中展示可点击图标/列表。
  - 实现番茄钟模块：计时逻辑、状态切换、系统通知。
  - 实现音乐信息展示：读取当前播放音乐信息（优先 Apple Music）。
  - 优化刘海区域的交互与动画。

- [ ] **阶段 7：v3 AI 模块与进阶功能**
  - AI 小助手模块：对话 UI、与 LLM API 的调用流程。
  - 智能提醒及自动化（如日程提醒、专注模式自动切换）。

### 8.2 使用说明

- 当某个阶段完成后，将对应行的 `[ ]` 改为 `[x]`，例如：`- [x] 阶段 1：需求与规范整理`。
- 若某阶段被拆分为更细的任务，可以在该阶段下继续增加子项（保持同样的 Markdown 风格）。
- 若在开发过程中调整功能范围或技术选型，应同步修改本节内容，并在《AI知识库.md》中补充新的设计决策。
